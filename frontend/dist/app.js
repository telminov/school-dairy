(function() {
  angular.module('schoolDairy', ['ngResource', 'ngSanitize', 'ngRoute', 'ngAnimate', 'ui.bootstrap', 'toaster', 'swAuth', 'swUtils']).config(function($routeProvider) {
    return $routeProvider.when('/', {
      templateUrl: 'src/app/controllers/main.html',
      controller: 'MainCtrl',
      label: ''
    }).when('/schedule/', {
      templateUrl: 'src/app/controllers/schedule.html',
      controller: 'ScheduleCtrl',
      label: 'Расписание'
    }).when('/login/', {
      templateUrl: 'src/app/controllers/login.html',
      controller: 'AuthLoginCtrl',
      label: 'Вход'
    }).when('/logout/', {
      templateUrl: 'src/app/controllers/logout.html',
      controller: 'AuthLogoutCtrl',
      label: 'Выход'
    });
  }).config(function(authConfigProvider, config) {
    authConfigProvider.setSystemLabel('Дневник');
    authConfigProvider.setServerAddress(config.serverAddress);
    return authConfigProvider.setFreeUrls(['/', '/schedule/']);
  }).config(function($httpProvider) {
    return $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';
  }).run(function($location, $rootScope, swTitle) {
    $rootScope.swTitle = swTitle;
    return $rootScope.$on('$routeChangeSuccess', function(event, current, previous) {
      var baseTitle, ref;
      baseTitle = ((ref = current.$$route) != null ? ref.label : void 0) || '';
      swTitle.setTitleBase(baseTitle);
      swTitle.setTitleStart('');
      return swTitle.setTitleEnd('');
    });
  });

}).call(this);

(function() {
  angular.module('schoolDairy').config(function($httpProvider) {
    return $httpProvider.interceptors.push('serverErrorInterceptor');
  }).factory('serverErrorInterceptor', function($location, $q, $log) {
    return {
      responseError: function(response) {
        if (response.status === 0 || (response.status >= 500 && response.status <= 600)) {
          $log.error(response);
        }
        return $q.reject(response);
      }
    };
  });

}).call(this);

(function() {
  angular.module('schoolDairy').constant('config', {
    serverAddress: 'http://192.168.160.10:8000'
  });

}).call(this);

(function() {
  angular.module('schoolDairy').controller('MainCtrl', function($scope, $location) {
    return $location.path('/schedule/');
  });

}).call(this);

(function() {
  angular.module('schoolDairy').controller('NavBarCtrl', function($scope, $location, auth) {
    $scope.auth = auth;
    return $scope.isActive = function(viewLocation) {
      return viewLocation === $location.path();
    };
  });

}).call(this);

(function() {
  angular.module('schoolDairy').controller('ScheduleCtrl', function($scope, $log, toaster, schedule, DayItem) {
    $scope.schedule = schedule;
    $scope.dayItems = DayItem.query();
    $scope.loading = true;
    return schedule.load().then(function() {
      return $scope.loading = false;
    }, function(response) {
      $scope.loading = false;
      toaster.pop('error', 'Ошибка', 'Не удалось получить расписание занятий');
      return $log.error(response);
    });
  });

}).call(this);

(function() {
  angular.module('schoolDairy').factory('DayItem', function($resource, config) {
    var url;
    url = config.serverAddress + "/day_item/:id/";
    return $resource(url);
  });

}).call(this);

(function() {
  angular.module('schoolDairy').service('schedule', function($http, config) {
    this.days = [];
    this._items = {};
    this.load = function() {
      var promise, url;
      this.days.length = 0;
      this._items = {};
      url = config.serverAddress + "/get_schedule/";
      promise = $http.get(url);
      promise.then((function(_this) {
        return function(response) {
          var day, i, item, len, ref, results;
          ref = response.data.schedule;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            day = ref[i];
            _this.days.push(day);
            results.push((function() {
              var j, len1, ref1, results1;
              ref1 = day.items;
              results1 = [];
              for (j = 0, len1 = ref1.length; j < len1; j++) {
                item = ref1[j];
                if (!this._items[day.name]) {
                  this._items[day.name] = {};
                }
                results1.push(this._items[day.name][item.day_item.id] = item);
              }
              return results1;
            }).call(_this));
          }
          return results;
        };
      })(this));
      return promise;
    };
    this.getItem = (function(_this) {
      return function(dayName, dayItem) {
        var ref;
        return (ref = _this._items[dayName]) != null ? ref[dayItem.id] : void 0;
      };
    })(this);
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5jb2ZmZWUiLCJpbnRlcmNlcHRvcnMuY29mZmVlIiwiY29uZmlnL2NvbmZpZy5jb2ZmZWUiLCJjb250cm9sbGVycy9tYWluLmNvZmZlZSIsImNvbnRyb2xsZXJzL25hdi5jb2ZmZWUiLCJjb250cm9sbGVycy9zY2hlZHVsZS5jb2ZmZWUiLCJyZXNvdXJjZXMvZGF5X2l0ZW0uY29mZmVlIiwicmVzb3VyY2VzL3NjaGVkdWxlLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLEVBQUEsT0FBTyxDQUFDLE1BQVIsQ0FBZSxhQUFmLEVBQThCLENBQzFCLFlBRDBCLEVBRTFCLFlBRjBCLEVBRzFCLFNBSDBCLEVBSTFCLFdBSjBCLEVBTTFCLGNBTjBCLEVBTzFCLFNBUDBCLEVBUzFCLFFBVDBCLEVBVTFCLFNBVjBCLENBQTlCLENBYUEsQ0FBQyxNQWJELENBYVEsU0FBQyxjQUFELEdBQUE7V0FDSixjQUVBLENBQUMsSUFGRCxDQUVNLEdBRk4sRUFHSTtBQUFBLE1BQUEsV0FBQSxFQUFhLCtCQUFiO0FBQUEsTUFDQSxVQUFBLEVBQVksVUFEWjtBQUFBLE1BRUEsS0FBQSxFQUFPLEVBRlA7S0FISixDQVFBLENBQUMsSUFSRCxDQVFNLFlBUk4sRUFTSTtBQUFBLE1BQUEsV0FBQSxFQUFhLG1DQUFiO0FBQUEsTUFDQSxVQUFBLEVBQVksY0FEWjtBQUFBLE1BRUEsS0FBQSxFQUFPLFlBRlA7S0FUSixDQWNBLENBQUMsSUFkRCxDQWNNLFNBZE4sRUFlSTtBQUFBLE1BQUEsV0FBQSxFQUFhLGdDQUFiO0FBQUEsTUFDQSxVQUFBLEVBQVksZUFEWjtBQUFBLE1BRUEsS0FBQSxFQUFPLE1BRlA7S0FmSixDQW1CQSxDQUFDLElBbkJELENBbUJNLFVBbkJOLEVBb0JJO0FBQUEsTUFBQSxXQUFBLEVBQWEsaUNBQWI7QUFBQSxNQUNBLFVBQUEsRUFBWSxnQkFEWjtBQUFBLE1BRUEsS0FBQSxFQUFPLE9BRlA7S0FwQkosRUFESTtFQUFBLENBYlIsQ0F3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LENBTEEsQ0FBQTtBQWdCQSxhQUFPLE9BQVAsQ0FqQlE7SUFBQSxDQUhaLENBQUE7QUFBQSxJQXNCQSxJQUFJLENBQUMsT0FBTCxHQUFlLENBQUEsU0FBQSxLQUFBLEdBQUE7YUFBQSxTQUFDLE9BQUQsRUFBVSxPQUFWLEdBQUE7QUFDWCxZQUFBLEdBQUE7QUFBQSwwREFBNkIsQ0FBQSxPQUFPLENBQUMsRUFBUixVQUE3QixDQURXO01BQUEsRUFBQTtJQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0F0QmYsQ0FEaUI7RUFBQSxDQUZyQixDQUFBLENBQUE7QUFBQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnc2Nob29sRGFpcnknLCBbXG4gICAgJ25nUmVzb3VyY2UnXG4gICAgJ25nU2FuaXRpemUnXG4gICAgJ25nUm91dGUnXG4gICAgJ25nQW5pbWF0ZSdcblxuICAgICd1aS5ib290c3RyYXAnXG4gICAgJ3RvYXN0ZXInXG5cbiAgICAnc3dBdXRoJ1xuICAgICdzd1V0aWxzJ1xuXSlcblxuLmNvbmZpZyAoJHJvdXRlUHJvdmlkZXIpIC0+XG4gICAgJHJvdXRlUHJvdmlkZXJcblxuICAgIC53aGVuKCcvJyxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdzcmMvYXBwL2NvbnRyb2xsZXJzL21haW4uaHRtbCdcbiAgICAgICAgY29udHJvbGxlcjogJ01haW5DdHJsJ1xuICAgICAgICBsYWJlbDogJydcbiAgICApXG5cbiAgICAud2hlbignL3NjaGVkdWxlLycsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnc3JjL2FwcC9jb250cm9sbGVycy9zY2hlZHVsZS5odG1sJ1xuICAgICAgICBjb250cm9sbGVyOiAnU2NoZWR1bGVDdHJsJ1xuICAgICAgICBsYWJlbDogJ9Cg0LDRgdC/0LjRgdCw0L3QuNC1J1xuICAgIClcblxuICAgIC53aGVuKCcvbG9naW4vJyxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdzcmMvYXBwL2NvbnRyb2xsZXJzL2xvZ2luLmh0bWwnXG4gICAgICAgIGNvbnRyb2xsZXI6ICdBdXRoTG9naW5DdHJsJ1xuICAgICAgICBsYWJlbDogJ9CS0YXQvtC0J1xuICAgIClcbiAgICAud2hlbignL2xvZ291dC8nLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3NyYy9hcHAvY29udHJvbGxlcnMvbG9nb3V0Lmh0bWwnXG4gICAgICAgIGNvbnRyb2xsZXI6ICdBdXRoTG9nb3V0Q3RybCdcbiAgICAgICAgbGFiZWw6ICfQktGL0YXQvtC0J1xuICAgIClcblxuXG4uY29uZmlnIChhdXRoQ29uZmlnUHJvdmlkZXIsIGNvbmZpZykgLT5cbiAgICBhdXRoQ29uZmlnUHJvdmlkZXIuc2V0U3lzdGVtTGFiZWwoJ9CU0L3QtdCy0L3QuNC6JylcbiAgICBhdXRoQ29uZmlnUHJvdmlkZXIuc2V0U2VydmVyQWRkcmVzcyhjb25maWcuc2VydmVyQWRkcmVzcylcbiAgICBhdXRoQ29uZmlnUHJvdmlkZXIuc2V0RnJlZVVybHMoW1xuICAgICAgICAnLydcbiAgICAgICAgJy9zY2hlZHVsZS8nXG4gICAgXSlcblxuLmNvbmZpZyAoJGh0dHBQcm92aWRlcikgLT5cbiAgICAkaHR0cFByb3ZpZGVyLmRlZmF1bHRzLmhlYWRlcnMucG9zdFsnQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ1xuXG4ucnVuICgkbG9jYXRpb24sICRyb290U2NvcGUsIHN3VGl0bGUpIC0+XG4gICAgJHJvb3RTY29wZS5zd1RpdGxlID0gc3dUaXRsZVxuXG4gICAgJHJvb3RTY29wZS4kb24gJyRyb3V0ZUNoYW5nZVN1Y2Nlc3MnLCAoZXZlbnQsIGN1cnJlbnQsIHByZXZpb3VzKSAtPlxuICAgICAgICBiYXNlVGl0bGUgPSBjdXJyZW50LiQkcm91dGU/LmxhYmVsIG9yICcnXG4gICAgICAgIHN3VGl0bGUuc2V0VGl0bGVCYXNlKGJhc2VUaXRsZSlcbiAgICAgICAgc3dUaXRsZS5zZXRUaXRsZVN0YXJ0KCcnKVxuICAgICAgICBzd1RpdGxlLnNldFRpdGxlRW5kKCcnKSIsImFuZ3VsYXIubW9kdWxlKCdzY2hvb2xEYWlyeScpXG5cbiMg0L/QtdGA0LXRhdCy0LDRgiA1MDDRhSDQvtGI0LjQsdC+0Log0YHQtdGA0LLQtdGA0LBcbi5jb25maWcgKCRodHRwUHJvdmlkZXIpIC0+XG4gICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnc2VydmVyRXJyb3JJbnRlcmNlcHRvcicpXG5cbi5mYWN0b3J5ICdzZXJ2ZXJFcnJvckludGVyY2VwdG9yJywgKCRsb2NhdGlvbiwgJHEsICRsb2cpIC0+XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXNwb25zZUVycm9yOiAocmVzcG9uc2UpIC0+XG4gICAgICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzID09IDAgb3IgKHJlc3BvbnNlLnN0YXR1cyA+PSA1MDAgYW5kIHJlc3BvbnNlLnN0YXR1cyA8PSA2MDApXG4gICAgICAgICAgICAgICAgICAgICRsb2cuZXJyb3IocmVzcG9uc2UpXG4jICAgICAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSByZXNwb25zZS5zdGF0dXNUZXh0IG9yICcnXG4jICAgICAgICAgICAgICAgICAgICB0b2FzdGVyLnBvcCgnZXJyb3InLCAn0J7RiNC40LHQutCwINGB0LXRgNCy0LXRgNCwJywgZXJyb3JNZXNzYWdlKVxuICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVzcG9uc2UpXG5cbiAgICAgICAgfSIsImFuZ3VsYXIubW9kdWxlKCdzY2hvb2xEYWlyeScpXG4gICAgLmNvbnN0YW50KCdjb25maWcnLCB7XG4gICAgICAgIHNlcnZlckFkZHJlc3M6ICdodHRwOi8vMTkyLjE2OC4xNjAuMTA6ODAwMCcsXG4jICAgICAgICBzZXJ2ZXJBZGRyZXNzOiAnaHR0cDovLzEyNy4wLjAuMTo4MDAxJyxcbiAgICB9KSIsImFuZ3VsYXIubW9kdWxlKCdzY2hvb2xEYWlyeScpXG4uY29udHJvbGxlciAnTWFpbkN0cmwnLCAoJHNjb3BlLCAkbG9jYXRpb24pIC0+XG4gICAgJGxvY2F0aW9uLnBhdGgoJy9zY2hlZHVsZS8nKSIsImFuZ3VsYXIubW9kdWxlKCdzY2hvb2xEYWlyeScpXG4uY29udHJvbGxlciAnTmF2QmFyQ3RybCcsICgkc2NvcGUsICRsb2NhdGlvbiwgYXV0aCkgLT5cbiAgICAkc2NvcGUuYXV0aCA9IGF1dGhcblxuICAgICRzY29wZS5pc0FjdGl2ZSA9ICh2aWV3TG9jYXRpb24pIC0+XG4gICAgICAgIHJldHVybiB2aWV3TG9jYXRpb24gPT0gJGxvY2F0aW9uLnBhdGgoKVxuIiwiYW5ndWxhci5tb2R1bGUoJ3NjaG9vbERhaXJ5Jylcbi5jb250cm9sbGVyICdTY2hlZHVsZUN0cmwnLCAoJHNjb3BlLCAkbG9nLCB0b2FzdGVyLCBzY2hlZHVsZSwgRGF5SXRlbSkgLT5cbiAgICAkc2NvcGUuc2NoZWR1bGUgPSBzY2hlZHVsZVxuICAgICRzY29wZS5kYXlJdGVtcyA9IERheUl0ZW0ucXVlcnkoKVxuXG4gICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlXG4gICAgc2NoZWR1bGUubG9hZCgpLnRoZW4oXG4gICAgICAgIC0+ICRzY29wZS5sb2FkaW5nID0gZmFsc2VcbiAgICAgICAgKHJlc3BvbnNlKSAtPlxuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZVxuICAgICAgICAgICAgdG9hc3Rlci5wb3AoJ2Vycm9yJywgJ9Ce0YjQuNCx0LrQsCcsICfQndC1INGD0LTQsNC70L7RgdGMINC/0L7Qu9GD0YfQuNGC0Ywg0YDQsNGB0L/QuNGB0LDQvdC40LUg0LfQsNC90Y/RgtC40LknKVxuICAgICAgICAgICAgJGxvZy5lcnJvcihyZXNwb25zZSlcbiAgICApXG4iLCJhbmd1bGFyLm1vZHVsZSgnc2Nob29sRGFpcnknKVxuXG4uZmFjdG9yeSAnRGF5SXRlbScsICgkcmVzb3VyY2UsIGNvbmZpZykgLT5cbiAgICB1cmwgPSBcIiN7IGNvbmZpZy5zZXJ2ZXJBZGRyZXNzIH0vZGF5X2l0ZW0vOmlkL1wiXG4gICAgcmV0dXJuICRyZXNvdXJjZSh1cmwpIiwiYW5ndWxhci5tb2R1bGUoJ3NjaG9vbERhaXJ5JylcblxuLnNlcnZpY2UgJ3NjaGVkdWxlJywgKCRodHRwLCBjb25maWcpIC0+XG4gICAgdGhpcy5kYXlzID0gW11cbiAgICB0aGlzLl9pdGVtcyA9IHt9XG5cbiAgICB0aGlzLmxvYWQgPSAtPlxuICAgICAgICB0aGlzLmRheXMubGVuZ3RoID0gMFxuICAgICAgICB0aGlzLl9pdGVtcyA9IHt9XG5cbiAgICAgICAgdXJsID0gXCIjeyBjb25maWcuc2VydmVyQWRkcmVzcyB9L2dldF9zY2hlZHVsZS9cIlxuICAgICAgICBwcm9taXNlID0gJGh0dHAuZ2V0KHVybClcbiAgICAgICAgcHJvbWlzZS50aGVuKFxuICAgICAgICAgICAgKHJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgICAgIGZvciBkYXkgaW4gcmVzcG9uc2UuZGF0YS5zY2hlZHVsZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRheXMucHVzaChkYXkpXG5cbiAgICAgICAgICAgICAgICAgICAgZm9yIGl0ZW0gaW4gZGF5Lml0ZW1zXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdGhpcy5faXRlbXNbZGF5Lm5hbWVdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faXRlbXNbZGF5Lm5hbWVdID0ge31cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1zW2RheS5uYW1lXVtpdGVtLmRheV9pdGVtLmlkXSA9IGl0ZW1cblxuICAgICAgICApXG4gICAgICAgIHJldHVybiBwcm9taXNlXG5cbiAgICB0aGlzLmdldEl0ZW0gPSAoZGF5TmFtZSwgZGF5SXRlbSkgPT5cbiAgICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zW2RheU5hbWVdP1tkYXlJdGVtLmlkXVxuXG4gICAgcmV0dXJuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9